<!DOCTYPE html>
<html>

<head>
    <title>Sketchpad demo</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
        }
        html, body {
            width: 100%;
            height: 100%;
        }
        #root {
            width: 100%;
            height: 100%;
        }
        canvas {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="root" >
        <canvas id="canvas"></canvas>
    </div>
    <script type="text/javascript">
        let isDown = false;
        let points = [];
        let beginPoint = null;
        const canvas = document.querySelector('#canvas');
        const ctx = canvas.getContext('2d');

        canvas.height = canvas.parentElement.offsetHeight - 2;
        canvas.width = canvas.parentElement.offsetWidth;

        // 设置线条颜色
        ctx.strokeStyle = 'red'; // 线条颜色
        ctx.lineWidth = 1; // 线宽
        ctx.lineJoin = 'round'; // 边角的类型，当两条线交汇时
        ctx.lineCap = 'round'; // 线条末端线帽的样式

        // canvas事件绑定
        canvas.addEventListener('mousedown', down, false);
        canvas.addEventListener('mousemove', move, false);
        canvas.addEventListener('mouseup', up, false);
        canvas.addEventListener('mouseout', up, false);

        // 鼠标按下
        function down(evt) {
            isDown = true;
            const { x, y } = getPos(evt);
            points.push({ x, y });
            beginPoint = { x, y };
        }

        // 鼠标移动
        function move(evt) {
            if (!isDown) return;

            const { x, y } = getPos(evt);
            points.push({ x, y });

            if (points.length > 3) {
                const lastTwoPoints = points.slice(-2);
                const controlPoint = lastTwoPoints[0];
                const endPoint = {
                    x: (lastTwoPoints[0].x + lastTwoPoints[1].x) / 2,
                    y: (lastTwoPoints[0].y + lastTwoPoints[1].y) / 2,
                }
                drawLine(beginPoint, controlPoint, endPoint);
                beginPoint = endPoint;
            }
        }

        // 鼠标抬起
        function up(evt) {
            if (!isDown) return;
            const { x, y } = getPos(evt);
            points.push({ x, y });

            if (points.length > 3) {
                const lastTwoPoints = points.slice(-2);
                const controlPoint = lastTwoPoints[0];
                const endPoint = lastTwoPoints[1];
                drawLine(beginPoint, controlPoint, endPoint);
            }
            beginPoint = null;
            isDown = false;
            points = [];
        }

        // 获取当前点
        function getPos(evt) {
            return {
                x: evt.clientX,
                y: evt.clientY
            }
        }

        // 画线
        function drawLine(beginPoint, controlPoint, endPoint) {
            ctx.beginPath();
            ctx.moveTo(beginPoint.x, beginPoint.y);
            ctx.quadraticCurveTo(controlPoint.x, controlPoint.y, endPoint.x, endPoint.y);
            ctx.stroke();
            ctx.closePath();
        }

    </script>
</body>

</html>