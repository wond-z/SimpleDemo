<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>Hiprint打印模板编辑器</title>
        <!-- hiprint -->
        <link href="./libs/hiprint/hiprint.css" rel="stylesheet">
        <link href="./libs/hiprint/print-lock.css" rel="stylesheet">
        <link href="./libs/hiprint/print-lock.css" media="print" rel="stylesheet">
        <!-- bootstrap、font-awesome -->
        <link href="./libs/bootstrap-3.4.1-dist/css/bootstrap.min.css" rel="stylesheet">
        <!-- <link rel="stylesheet" href="../libs/font-awesome-4.7.0/css/font-awesome.min.css"> -->
        <link href="./custom/custom.css" rel="stylesheet">
        <script src="./libs/jquery.min.js" charset="utf-8"></script>
        <!-- hiprint 核心js-->
        <script src="./libs/hiprint/hiprint.bundle.js"></script>
        <!-- 兼容依赖 -->
        <script src="./libs/polyfill.min.js"></script>

        <script src="./libs/plugins/jquery.minicolors.min.js"></script>
        <!-- 二维码和条形码 -->
        <script src="./libs/plugins/JsBarcode.all.min.js" charset="utf-8"></script>
        <script src="./libs/plugins/qrcode.js" charset="utf-8"></script>
        <!-- 调用浏览器打印窗口helper类，可自行替换-->
        <script src="./libs/plugins/jquery.hiwprint.js"></script>
        <script src="./libs/bootstrap-3.4.1-dist/js/bootstrap.min.js"></script>
    </head>
    <body>
        <div class="container-fluid height-100-per print-content">
            <div class="row">
                <div class="col-sm-3 col-md-2">
                    <div class="rect-printElement-types hiprintEpContainer">
                        <ul class="hiprint-printElement-type">
                            <li>
                                <span class="title"><span class="glyphicon glyphicon-th"></span> 拖拽列表</span>
                                <ul>
                                    <li>
                                        <a class="ep-draggable-item" tid="testModule.text">
                                            <span class="glyphicon glyphicon-text-width" aria-hidden="true"></span>
                                            <span class="glyphicon-class">文本</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="ep-draggable-item" tid="testModule.image">
                                            <span class="glyphicon glyphicon-picture" aria-hidden="true"></span>
                                            <span class="glyphicon-class">图片</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="ep-draggable-item" tid="testModule.longText">
                                            <span class="glyphicon glyphicon-subscript" aria-hidden="true"></span>
                                            <span class="glyphicon-class">长文</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="ep-draggable-item" tid="testModule.tableCustom">
                                            <span class="glyphicon glyphicon-th" aria-hidden="true"></span>
                                            <span class="glyphicon-class">表格</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="ep-draggable-item" tid="testModule.html">
                                            <span class="glyphicon glyphicon-header" aria-hidden="true"></span>
                                            <span class="glyphicon-class">html</span>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <span class="title"><i class="fa fa-cubes"></i>辅助</span>
                                <ul>
                                    <li>
                                        <a class="ep-draggable-item" tid="testModule.hline">
                                            <span class="glyphicon glyphicon-resize-horizontal" aria-hidden="true"></span>
                                            <span class="glyphicon-class">横线</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="ep-draggable-item" tid="testModule.vline">
                                            <span class="glyphicon glyphicon-resize-vertical" aria-hidden="true"></span>
                                            <span class="glyphicon-class">竖线</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="ep-draggable-item" tid="testModule.rect">
                                            <span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span>
                                            <span class="glyphicon-class">矩形</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="ep-draggable-item" tid="testModule.oval">
                                            <span class="glyphicon glyphicon-record" aria-hidden="true"></span>
                                            <span class="glyphicon-class">椭圆</span>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-6 col-md-8 m-t-15">
                    <div class="form-inline">
                        <label>尺寸设置</label>
                        <div class="btn-group btn-group-sm" role="group" aria-label="...">
                            <button type="button" class="btn btn-default" onclick="setPaper('A3')">A3</button>
                            <button type="button" class="btn btn-default" onclick="setPaper('A4')">A4</button>
                            <button type="button" class="btn btn-default" onclick="setPaper('A5')">A5</button>
                            <button type="button" class="btn btn-default" onclick="setPaper('B3')">B3</button>
                            <button type="button" class="btn btn-default" onclick="setPaper('B4')">B4</button>
                            <button type="button" class="btn btn-default" onclick="setPaper('B5')">B5</button>

                            <div class="form-group m-l-20">
                                <label>宽</label>
                                <input type="text" class="form-control input-sm page-size-custom" id="customWidth" placeholder="mm">
                            </div>
                            <div class="form-group">
                                <label>× 高</label>
                                <input type="text" class="form-control input-sm page-size-custom" id="customHeight" placeholder="mm">
                            </div>
                            <div class="form-group">
                                <button type="button" class="btn btn-success btn-sm" onclick="setPaper($('#customWidth').val(),$('#customHeight').val())">确定</button>
                            </div>
                            <div class="form-group m-l-20">
                                <button type="button" class="btn btn-default btn-sm" onclick="rotatePaper()"><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> 旋转</button>
                            </div>
                        </div>
                        <div class="pull-right">
                            <button type="button" class="btn btn-danger btn-sm" onclick="clearTemplate()"><span class="glyphicon glyphicon-erase" aria-hidden="true"></span> 清空</button>
                            <button type="button" class="btn btn-success btn-sm" id="A4_preview"><span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span> 预览</button>
                            <button type="button" class="btn btn-primary btn-sm" id="A4_directPrint"><span class="glyphicon glyphicon-print" aria-hidden="true"></span> 打印</button>
                        </div>
                    </div>
                    <div id="hiprint-printTemplate" class="hiprint-printTemplate rc" style="padding:20px; overflow-x: scroll; overflow-y: auto;"></div>
                </div>
                <div class="col-sm-3 col-md-2">
                    <div id="PrintElementOptionSetting"></div>
                </div>
            </div>
        </div>

        <!-- 弹出预览窗 -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog modal-lg" role="document" style="width: 825px;">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">打印预览</h4>
                    </div>
                    <div class="modal-body">
                        <div class="prevViewDiv"></div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" id="bill_print"><span class="glyphicon glyphicon-print"></span> 打印</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> 关闭</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- 创建拖拽元素时动态生成的dom元素 -->
        <script src="./custom/custom-etype-provider.js"></script>
        <!-- 默认模板数据 -->
        <!-- <script src="./custom/custom-print-json.js"></script> -->
        <script type="text/javascript">
            var hiprintTemplate;
            $(document).ready(function () {

                //初始化打印插件
                hiprint.init({
                    providers: [new customElementTypeProvider()]
                });

                // hiprint.PrintElementTypeManager.build('.hiprintEpContainer', 'testModule');
                //设置左侧拖拽事件
                hiprint.PrintElementTypeManager.buildByHtml($('.ep-draggable-item'));

                hiprintTemplate = new hiprint.PrintTemplate({
                    // template: customPrintJson,
                    settingContainer: '#PrintElementOptionSetting',
                    paginationContainer: '.hiprint-printPagination'
                });

                //打印设计
                hiprintTemplate.design('#hiprint-printTemplate');

                $('#A4_preview').click(function () {
                    $('#myModal .modal-body .prevViewDiv').html(hiprintTemplate.getHtml({}));
                    $('#myModal').modal('show');
                });

                $('#A4_directPrint').click(function () {
                    hiprintTemplate.print(printData);
                });
                $('#A4_printByHtml').click(function () {
                    hiprintTemplate.printByHtml($('#myModal .modal-body .prevViewDiv'));
                })
                $('#A4_getJson_toTextarea').click(function () {
                    $('#A4_textarea_json').html(JSON.stringify(hiprintTemplate.getJson()))
                })
                $('#A4_getHtml_toTextarea').click(function () {
                    $('#A4_textarea_html').val(hiprintTemplate.getHtml(printData)[0].outerHTML)
                })

                // 设置初始纸张尺寸
                setPaper('322', '130');
                // 页面初始化完成后展示页面配置区域
                $('.hiprint-printPanel').click();
                // 自定义监听脚本
                document.onkeydown = function (event) {
                    if (event.keyCode === 46) {
                        $('.hiprint-option-item-deleteBtn').click();
                        $('.hiprint-printPanel').click();
                    }
                }
            });

            //调整纸张
            var setPaper = function (paperTypeOrWidth, height) {
                hiprintTemplate.setPaper(paperTypeOrWidth, height);
                $('#customWidth').val('');
                $('#customHeight').val('');
            }

            //纸张
            var rotatePaper = function () {
                hiprintTemplate.rotatePaper();
            }

            // 清空模板
            var clearTemplate = function () {
                hiprintTemplate.clear();
            }
        </script>
    </body>
</html>
